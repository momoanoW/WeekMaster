<!-- Task Display - Generische Komponente für Grid und Table -->
<div class="task-display">
  
  <!-- Loading State -->
  @if (isLoading) {
    <div class="flex justify-center items-center py-8">
      <div class="text-text-default">Lade Tasks...</div>
    </div>
  }
  
  <!-- Keine Tasks -->
  @else if (tasks.length === 0) {
    <div class="flex justify-center items-center py-8">
      <div class="text-text-default">Keine Tasks vorhanden</div>
    </div>
  }
  
  <!-- Grid Modus - Task Cards -->
  @else if (mode === 'grid') {
    <div class="container mx-auto px-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6 items-stretch">
      <app-task-card
        *ngFor="let task of tasks; trackBy: trackByTaskId"
        [task]="task"
        (statusChange)="onStatusChange($event)"
        (editTask)="onEditTask($event)"
        (deleteTask)="onDeleteTask($event)">
      </app-task-card>
    </div>
  }
  
  <!-- Table Modus - Tabellen-Ansicht -->
  @else if (mode === 'table') {
    <div class="bg-background border border-border rounded">
      <div class="overflow-hidden md:overflow-x-auto">
        <table class="w-full border-collapse bg-transparent min-w-[700px]">
          <thead class="bg-primary/10 border-b-2 border-primary/20">
            <tr>
              <th class="px-6 py-4 text-left font-semibold text-text-dark text-sm uppercase tracking-wide border-0 whitespace-nowrap">Task</th>
              <th class="hidden sm:table-cell px-6 py-4 text-left font-semibold text-text-dark text-sm uppercase tracking-wide border-0 whitespace-nowrap">Status</th>
              <th class="hidden md:table-cell px-6 py-4 text-left font-semibold text-text-dark text-sm uppercase tracking-wide border-0 whitespace-nowrap">Priorität</th>
              <th class="hidden lg:table-cell px-6 py-4 text-left font-semibold text-text-dark text-sm uppercase tracking-wide border-0 whitespace-nowrap">Fällig am</th>
              <th class="hidden md:table-cell px-6 py-4 text-left font-semibold text-text-dark text-sm uppercase tracking-wide border-0 whitespace-nowrap">Tags</th>
              <th class="px-6 py-4 text-left font-semibold text-text-dark text-sm uppercase tracking-wide border-0 whitespace-nowrap">Aktionen</th>
            </tr>
          </thead>
          <tbody>
            @for (task of tasks; track trackByTaskId($index, task)) {
              <tr class="border-b border-border/30 hover:bg-primary/5 transition-colors">
                <!-- Task Title -->
                <td class="px-6 py-4 text-text-dark border-0 align-middle">
                  <div class="font-medium text-text-dark">{{ task.beschreibung }}</div>
                  <!-- Mobile: Status als Badge anzeigen -->
                  <div class="sm:hidden mt-2">
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium whitespace-nowrap"
                          [class]="getStatusClasses(task.status_name)">
                      {{ task.status_name }}
                    </span>
                  </div>
                  <!-- Mobile: Priorität und Fälligkeitsdatum anzeigen -->
                  <div class="sm:hidden flex flex-wrap gap-2 mt-2">
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium whitespace-nowrap"
                          [class]="getPriorityClasses(task.prio_name)">
                      {{ task.prio_name }}
                    </span>
                    <span class="text-xs text-text-default" *ngIf="task.frist_datum">
                      {{ task.frist_datum | date : "dd.MM.yyyy" }}
                    </span>
                  </div>
                  <!-- Mobile: Tags anzeigen -->
                  <div class="md:hidden mt-2" *ngIf="task.tags">
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-background text-text-dark">
                      {{ task.tags }}
                    </span>
                  </div>
                </td>
                
                <!-- Status (hidden on mobile) -->
                <td class="hidden sm:table-cell px-6 py-4 text-text-dark border-0 align-middle">
                  <select 
                    [value]="task.status_name" 
                    (change)="onStatusChangeTable($event, task.aufgaben_id)"
                    class="px-2 py-1 rounded border border-border bg-background text-text-dark text-sm focus:outline-none focus:ring-2 focus:ring-primary/20">
                    <option value="Default">Default</option>
                    <option value="Offen">Offen</option>
                    <option value="Problem">Problem</option>
                    <option value="Beobachten">Beobachten</option>
                    <option value="Abstimmung nötig">Abstimmung nötig</option>
                    <option value="Erledigt">Erledigt</option>
                  </select>
                </td>
                
                <!-- Priority (hidden on mobile and small tablets) -->
                <td class="hidden md:table-cell px-6 py-4 text-text-dark border-0 align-middle">
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium whitespace-nowrap"
                        [class]="getPriorityClasses(task.prio_name)">
                    {{ task.prio_name }}
                  </span>
                </td>
                
                <!-- Due Date (hidden on mobile and tablets) -->
                <td class="hidden lg:table-cell px-6 py-4 text-text-dark border-0 align-middle">
                  <span class="text-sm text-text-default">
                    {{ task.frist_datum ? (task.frist_datum | date : "dd.MM.yyyy") : '-' }}
                  </span>
                </td>
                
                <!-- Tags (hidden on mobile) -->
                <td class="hidden md:table-cell px-6 py-4 text-text-dark border-0 align-middle">
                  @if (task.tags) {
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-background text-text-dark">
                      {{ task.tags }}
                    </span>
                  } @else {
                    <span class="text-text-default text-sm">-</span>
                  }
                </td>
                
                <!-- Actions -->
                <td class="px-6 py-4 text-text-dark border-0 align-middle">
                  <div class="flex gap-2">
                    <button 
                      (click)="onEditTask(task)" 
                      class="px-3 py-2 rounded text-sm font-medium transition-colors bg-primary text-text-dark hover:bg-primary/80"
                      title="Bearbeiten">
                      <span class="hidden sm:inline">Bearbeiten</span>
                      <span class="sm:hidden">✎</span>
                    </button>
                    <button 
                      (click)="onDeleteTask(task.aufgaben_id)" 
                      class="px-3 py-2 rounded text-sm font-medium transition-colors bg-warning text-text-dark hover:bg-warning/80"
                      title="Löschen">
                      <span class="hidden sm:inline">Löschen</span>
                      <span class="sm:hidden">✕</span>
                    </button>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  }
  
</div>
