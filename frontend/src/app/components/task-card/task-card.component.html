<div class="task-card" *ngIf="task">
  <!-- Card Header -->
  <div class="card-header">
    <div class="flex justify-between items-start mb-3">
      <h3 class="task-title text-lg font-semibold text-text-dark leading-snug max-w-[70%] sm:max-w-[60%]">
        {{ task.beschreibung }}
      </h3>
      <div class="flex gap-2 flex-shrink-0">
        <!-- Priority Badge -->
        <span [ngClass]="'priority-' + (task.prio_name ? task.prio_name.toLowerCase() : 'niedrig')">
          {{ task.prio_name }}
        </span>
        <!-- Overdue Indicator -->
        <span *ngIf="isOverdue()" class="overdue-badge">
          ÃœberfÃ¤llig
        </span>
      </div>
    </div>

    <!-- Due Date with Context -->
    <div class="mb-2" *ngIf="task.frist_datum">
      <div class="flex items-center gap-2 text-sm">
        <span class="text-sm">ðŸ“…</span>
        <span [class]="isOverdue() ? 'text-warning font-medium' : getDaysUntilDue() <= 3 ? 'text-accent font-medium' : 'text-text-default'">
          {{ formatDate(task.frist_datum) }}
          <span *ngIf="!isOverdue() && getDaysUntilDue() >= 0" class="text-xs opacity-75">
            ({{ getDaysUntilDue() === 0 ? 'Heute' : getDaysUntilDue() === 1 ? 'Morgen' : 'in ' + getDaysUntilDue() + ' Tagen' }})
          </span>
        </span>
      </div>
    </div>
  </div>

  <!-- Card Body -->
  <div class="flex-1">
    <!-- Status Section -->
    <div class="mb-4">
      <label class="block text-sm font-medium text-text-default mb-2">Status</label>
      <select 
        [value]="task.status_name" 
        (change)="onStatusChange($event)"
        class="form-select">
        <option value="Default">Default</option>
        <option value="Offen">Offen</option>
        <option value="In Bearbeitung">In Bearbeitung</option>
        <option value="Erledigt">Erledigt</option>
        <option value="Problem">Problem</option>
        <option value="Beobachten">Beobachten</option>
        <option value="Abstimmung nÃ¶tig">Abstimmung nÃ¶tig</option>
      </select>
    </div>

    <!-- Tags Section -->
    <div class="mb-4" *ngIf="task.tags">
      <label class="block text-sm font-medium text-text-default mb-2">Tags</label>
      <div class="flex flex-wrap gap-2">
        <span class="inline-flex items-center px-3 py-1 bg-border text-text-default rounded-full text-xs font-medium">
          {{ task.tags }}
        </span>
      </div>
    </div>

    <!-- Progress Indicator -->
    <div class="mb-4">
      <div class="flex justify-between items-center mb-2">
        <span class="text-sm font-medium text-text-default">Fortschritt</span>
        <span class="text-sm text-text-default opacity-75">
          {{ task.status_name === 'Erledigt' ? '100%' : 
             task.status_name === 'In Bearbeitung' ? '50%' : 
             task.status_name === 'Problem' ? '25%' : '0%' }}
        </span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" 
             [style.width]="task.status_name === 'Erledigt' ? '100%' : 
                           task.status_name === 'In Bearbeitung' ? '50%' : 
                           task.status_name === 'Problem' ? '25%' : '0%'">
        </div>
      </div>
    </div>
  </div>

  <!-- Card Footer -->
  <div class="card-footer">
    <div class="flex justify-between items-center">
      <!-- Task ID -->
      <span class="text-xs text-text-default opacity-60">ID: {{ task.aufgaben_id }}</span>
      
      <!-- Action Buttons -->
      <div class="flex gap-2">
        <button 
          (click)="onEdit()" 
          class="btn-primary px-3 py-2 text-sm"
          title="Bearbeiten">
          <span class="text-sm">âœŽ</span>
          <span class="hidden sm:inline ml-1">Bearbeiten</span>
        </button>
        <button 
          (click)="onDelete()" 
          class="btn-danger px-3 py-2 text-sm"
          title="LÃ¶schen">
          <span class="text-sm">ðŸ—‘</span>
          <span class="hidden sm:inline ml-1">LÃ¶schen</span>
        </button>
      </div>
    </div>
  </div>
</div>
