<div class="fixed inset-0 bg-black bg-opacity-50 flex-center" style="z-index: 1000;"> 
<!-- DIALOG HINTERGRUND: Vollbild-Overlay mit Z-Index damit es schwebt -->

  <div class="dialog-container">  
  <!-- HAUPTDIALOG: Responsive Container mit optimierter Gr√∂√üe und Scrolling -->

    <div class="flex justify-between items-center mb-4"> 
    <!-- DIALOG HEADER: Titel und Schlie√üen-Button mit Flexbox-Layout -->
      <h2 class="text-2xl font-bold text-text-dark">Neue Aufgabe eintragen</h2>
      <button (click)="confirmCloseDialog()" class="text-text-default hover:text-text-dark text-xl transition duration-300">&times;</button> 
    </div>

    <form [formGroup]="taskForm" (ngSubmit)="onSubmit()">
      
      <!-- SEKTION 1: GRUNDDATEN - Prim√§re Aufgabendaten in Gr√ºn-Ton -->
      <div class="bg-primary-subtle p-4 rounded mb-4">
        
        <div class="mb-4">
          <label for="beschreibung" class="block text-base font-bold text-text-dark mb-1">Beschreibung üìù</label> 
          <input type="text" id="beschreibung" formControlName="beschreibung" placeholder="Aufgabenname eingeben"
                 class="form-input focus:ring-primary focus:border-primary">
        </div>

        <div class="mb-0">
          <label for="user" class="block text-base font-bold text-text-dark mb-1">F√ºr wen ist die Aufgabe?</label>
          <select id="user" formControlName="users_name" class="form-select focus:ring-primary focus:border-primary">
            <option *ngFor="let user of users" [value]="user.users_name">{{ user.users_name }}</option>
          </select>
        </div>
      </div>

      <!-- SEKTION 2: ZEITMANAGEMENT - Fristen und Vorlaufzeiten in Gelb-Ton -->
      <div class="bg-accent-light p-4 rounded mb-4">
        
        <div class="mb-4">
          <label class="checkbox-label">
            <input type="checkbox" formControlName="hat_frist">
            <span class="font-bold text-text-dark">die Aufgabe hat eine Frist ‚è∞</span>
          </label>
        </div>

        <div class="mb-0 grid-responsive-2" *ngIf="taskForm.get('hat_frist')?.value">
          <div>
            <label for="frist_datum" class="block text-base font-bold text-text-dark mb-1">Frist</label> 
            <input type="date" id="frist_datum" formControlName="frist_datum" class="form-input focus:ring-primary focus:border-primary">
          </div>
          <div>
            <label for="vorlaufzeit" class="block text-base font-bold text-text-dark mb-1">Wie viele Tage vorher willst du damit anfangen?<span class="text-sm font-normal text-gray-600">(optional)</span></label>
            <input type="number" id="vorlaufzeit" formControlName="vorlaufzeit_tage" placeholder="0" class="form-input focus:ring-primary focus:border-primary">
          </div>
        </div>
      </div>

      <!-- SEKTION 3: KATEGORISIERUNG - Priorit√§t und Status in Hautfarb-Ton -->
      <div class="bg-skin p-4 rounded mb-4">
        <div class="mb-0">
          <div class="grid-responsive-sections">
            <!-- PRIORIT√ÑTS-AUSWAHL -->
            <div>
              <label class="block text-base font-bold text-text-dark mb-2">Welche Prio? üî•</label>
              <div class="grid-responsive-options">
                <label class="radio-label">
                  <input type="radio" formControlName="prio_name" value="Default">
                  <span>Default</span>
                </label>
                <label class="radio-label">
                  <input type="radio" formControlName="prio_name" value="Niedrig">
                  <span>Niedrig</span>
                </label>
                <label class="radio-label">
                  <input type="radio" formControlName="prio_name" value="Mittel">
                  <span>Mittel</span>
                </label>
                <label class="radio-label">
                  <input type="radio" formControlName="prio_name" value="Hoch">
                  <span>Hoch</span>
                </label>
              </div>
            </div>

            <!-- STATUS-AUSWAHL -->
            <div>
              <label class="block text-base font-bold text-text-dark mb-2">Wie ist der Bearbeitungsstand? üéØ </label>
              <div class="grid-responsive-options">
                <label class="radio-label">
                  <input type="radio" formControlName="status_name" value="Default">
                  <span>Default</span>
                </label>
                <label class="radio-label">
                  <input type="radio" formControlName="status_name" value="Offen">
                  <span>Offen</span>
                </label>
                <label class="radio-label">
                  <input type="radio" formControlName="status_name" value="In Bearbeitung">
                  <span>In Bearbeitung</span>
                </label>
                <label class="radio-label">
                  <input type="radio" formControlName="status_name" value="Erledigt">
                  <span>Erledigt</span>
                </label>
                <label class="radio-label">
                  <input type="radio" formControlName="status_name" value="Problem">
                  <span>Problem</span>
                </label>
                <label class="radio-label">
                  <input type="radio" formControlName="status_name" value="Beobachten">
                  <span>Beobachten</span>
                </label>
                <label class="radio-label">
                  <input type="radio" formControlName="status_name" value="Abstimmung n√∂tig">
                  <span>Abstimmung n√∂tig</span>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- SEKTION 4: TAG-VERWALTUNG - Mehrfachauswahl in Rosa-Ton -->
      <div class="bg-warning-light p-4 rounded mb-4">
        
        <div class="mb-0">
          <label class="block text-base font-bold text-text-dark mb-2">Tags üè∑Ô∏è <span class="text-sm font-normal text-gray-600">(Mehrfachauswahl m√∂glich)</span></label>
          <div class="grid-responsive-4" formArrayName="selectedTags">
            <label *ngFor="let tag of tags; let i = index" class="checkbox-label">
              <input type="checkbox" [value]="tag.tag_id" (change)="onTagChange($event)">
              <span>{{ tag.tag_name }}</span>
            </label>
          </div>
        </div>
      </div>

      <!-- SUCCESS MESSAGE - Best√§tigung nach erfolgreichem Speichern -->
      <div class="mb-4">
        <div *ngIf="confirmationMessage" class="bg-primary-subtle text-black p-2 rounded-m text-center">
          {{ confirmationMessage }}
        </div>
      </div>
      
      <!-- DIALOG ACTIONS - Haupt-Buttons f√ºr Speichern und Abbrechen -->
      <div class="flex justify-end gap-4 mt-4">
        <button type="button" (click)="confirmCloseDialog()" class="btn-secondary">Abbrechen</button>
        <button type="submit" [disabled]="taskForm.invalid" class="btn-primary">Speichern</button>
      </div>
    </form>

  </div>

  <!-- Universal Dialog f√ºr ungespeicherte √Ñnderungen -->
  <app-universal-dialog
    *ngIf="showConfirmDialog"
    type="warning"
    title="Ungespeicherter Eintrag"
    message="War die Aufgabe doch nicht so wichtig? üòâ"
    confirmText="Nicht wichtig"
    cancelText="Doch, wichtig!"
    confirmButtonType="danger"
    (confirm)="confirmClose()"
    (cancel)="cancelClose()">
  </app-universal-dialog>
</div>